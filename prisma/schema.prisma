generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_DATABASE_URL")
}

model Client {
  id        Int      @id @default(autoincrement())
  name      String
  url       String?
  cron      String?
  crawls    Crawl[]
  urls      Urls[]
  audits    Audit[]
}

model Crawl {
  id        Int      @id @default(autoincrement())
  client    Client   @relation(fields: [clientId], references: [id])
  clientId  Int
  url       String
  createdAt DateTime @default(now())
  urls      Urls[]
  audit     Audit?
}

model Urls {
  id             Int      @id @default(autoincrement())
  client         Client   @relation(fields: [clientId], references: [id])
  clientId       Int
  crawl          Crawl?   @relation(fields: [crawlId], references: [id])
  crawlId        Int?
  url            String
  status         Int?
  originalStatus String?
  redirectTarget String?
  canonical      String?
  canonicalStatus Int?
  isSelfReferencingCanonical Boolean @default(false)
  isCanonicalised Boolean @default(false)
  metaTitle      String?
  metaDescription String?
  internalLinks  String[]
  externalLinks  String[]
  internalLinkStatuses Json
  h1             String[]
  h2             String[]
  h3             String[]
  h4             String[]
  h5             String[]
  h6             String[]
  issues         String[] @default([])
  createdAt      DateTime @default(now())
}

model Audit {
  id        Int      @id @default(autoincrement())
  crawl     Crawl    @relation(fields: [crawlId], references: [id])
  crawlId   Int      @unique
  client    Client   @relation(fields: [clientId], references: [id])
  clientId  Int
  createdAt DateTime @default(now())

  // Existing count fields
  pages_missing_title        Int @default(0)
  too_short_title            Int @default(0)
  too_long_title             Int @default(0)
  pages_missing_description  Int @default(0)
  too_short_description      Int @default(0)
  too_long_description       Int @default(0)
  pages_missing_h1           Int @default(0)
  pages_with_multiple_h1s    Int @default(0)
  pages_with_duplicate_h1s   Int @default(0)
  pages_missing_h2           Int @default(0)
  pages_with_multiple_h2s    Int @default(0)
  pages_with_duplicate_h2s   Int @default(0)
  pages_missing_h3           Int @default(0)
  pages_with_multiple_h3s    Int @default(0)
  pages_with_duplicate_h3s   Int @default(0)
  pages_missing_h4           Int @default(0)
  pages_with_multiple_h4s    Int @default(0)
  pages_with_duplicate_h4s   Int @default(0)
  pages_missing_h5           Int @default(0)
  pages_with_multiple_h5s    Int @default(0)
  pages_with_duplicate_h5s   Int @default(0)
  pages_missing_h6           Int @default(0)
  pages_with_multiple_h6s    Int @default(0)
  pages_with_duplicate_h6s   Int @default(0)
  pages_200_response         Int @default(0)
  pages_3xx_response         Int @default(0)
  pages_4xx_response         Int @default(0)
  pages_5xx_response         Int @default(0)

  // New URL list fields
  pages_missing_title_urls        String[]
  too_short_title_urls            String[]
  too_long_title_urls             String[]
  pages_missing_description_urls  String[]
  too_short_description_urls      String[]
  too_long_description_urls       String[]
  pages_missing_h1_urls           String[]
  pages_with_multiple_h1s_urls    String[]
  pages_with_duplicate_h1s_urls   String[]
  pages_missing_h2_urls           String[]
  pages_with_multiple_h2s_urls    String[]
  pages_with_duplicate_h2s_urls   String[]
  pages_missing_h3_urls           String[]
  pages_with_multiple_h3s_urls    String[]
  pages_with_duplicate_h3s_urls   String[]
  pages_missing_h4_urls           String[]
  pages_with_multiple_h4s_urls    String[]
  pages_with_duplicate_h4s_urls   String[]
  pages_missing_h5_urls           String[]
  pages_with_multiple_h5s_urls    String[]
  pages_with_duplicate_h5s_urls   String[]
  pages_missing_h6_urls           String[]
  pages_with_multiple_h6s_urls    String[]
  pages_with_duplicate_h6s_urls   String[]
}
